// ==UserScript==
// @name         youtube_towatch_autoremover
// @namespace    http://tampermonkey.net/
// @version      1.0
// @description  Removes videos automatically from watch later when watched
// @author       kosshi
// @match        https://www.youtube.com/*
// @grant        none
// ==/UserScript==

// NOTE: This script may not work for some people, google likes to enable 
// styles and features only for some people, sometimes breaking this. 
// Feel free to fork a version that works for you.

(function(){
	'use strict';
	console.log('Towatch autoremover active.');

	if ( window.location.href.search('list=WL') > 0 ){
		console.log('The page is correct, document readystate is '+document.readyState);

		if ( document.readyState == 'complete') {
			removeFromList();
		} else {
			console.log('Waiting for page to load...');
			window.addEventListener('load', removeFromList);
		}
	}

	function removeFromList(){
		setTimeout( ()=>{ // Just doesn't work well without the timeout for some reason
			console.log('Removing video from playlist...');
			document.querySelector('.currently-playing > a > button').click();
			check();
		}, 2000 );
	}

	function check(){
		setTimeout( ()=>{
			if(document.querySelector('.currently-playing')) {
				console.log('Video wasn\'t auto-removed from the playlist, retry..');
				removeFromList();
			} else {
				console.log('Video has been removed from the playlist.');
			}
		}, 5000 );
	}

})();
